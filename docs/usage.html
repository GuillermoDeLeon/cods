<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Usage</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides in-depth documentation on how to use the <code>cods</code>
tool.</p>
</div>
<div class="sect2">
<h3 id="_table_of_contents">Table of Contents</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#the-cods-command">The <code>cods</code> command</a></p>
</li>
<li>
<p><a href="#commands">Commands</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#general-server-commands">General Server Commands</a></p>
</li>
<li>
<p><a href="#site-and-database-management-commands">Site and Database
Management Commands</a></p>
</li>
<li>
<p><a href="#examples">Examples</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#site-creation">Site Creation</a></p>
</li>
<li>
<p><a href="#database-management">Database Management</a></p>
</li>
<li>
<p><a href="#https">HTTPS</a></p>
</li>
<li>
<p><a href="#sharing-your-server">Sharing your server</a></p>
</li>
<li>
<p><a href="#bash-completion">Bash Completion</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_cods_command">The <code>cods</code> command</h3>
<div class="paragraph">
<p>The <code>cods</code> command allows you to setup a new server, or create a
command to manage a server that you have been granted access to.</p>
</div>
<div class="paragraph">
<p>While it is the first command you will use, you will be interacting with
the created commands more frequently.</p>
</div>
<div class="sect3">
<h4 id="_init"><code>init</code></h4>
<div class="paragraph">
<p>When a server is first setup, a command will be created that will be
your interface to that server.</p>
</div>
<div class="paragraph">
<p>For example, you could run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cods init myserver</pre>
</div>
</div>
<div class="paragraph">
<p>and this tool will prompt you for information to setup the server,
provision it, then create a command named <code>myserver</code> for you to use to
interact with the new server.</p>
</div>
<div class="paragraph">
<p>Before running the <code>init</code> command make sure you have</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A server with a fresh debian 10 (buster) install</p>
</li>
<li>
<p>Your ssh key on that server with access to the root account</p>
</li>
<li>
<p>The server’s ip address ready</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a server is created, a directory inside of <code>~/.config/cods</code> is
created that is named after the command name. This directory holds the
configuration for the server, the server credentials, and the default
directory for any database backups you create.</p>
</div>
<div class="paragraph">
<p>In the scenario above, these files and direcoty would be created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>~/.config/cods/myserver/env.sh</code>: holds the username and ip address
of the server</p>
</li>
<li>
<p><code>~/.config/cods/myserver/credentials.txt</code>: holds the sudo and
database passwords for the server, and any future generated passwords.</p>
</li>
<li>
<p><code>~/.config/cods/myserver/db-backups</code>: default location for the
database backups you create</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_note_on_credentials">A Note on Credentials</h4>
<div class="paragraph">
<p>Anything this tool does that sets up user accounts will autogenerate
passwords for the users and store them in the <code>credentials.txt</code> file
for the server. This allows easy access to the generated credentials
through the server management command.</p>
</div>
<div class="paragraph">
<p><strong>Note that these passwords <em>are</em> stored in plain text on your computer.</strong></p>
</div>
<div class="paragraph">
<p>If this is not an acceptable security tradeoff for you, you should
remove the <code>credentials.txt</code> file for your server, and update your
password storage solution whenever a new user or database account is
generated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_add"><code>add</code></h4>
<div class="paragraph">
<p>To add a server command to interact with an existing server that was
setup elsewhere (either by yourself on another computer or by a
teammate) you can use the <code>add</code> command. See the section on server
sharing below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_update"><code>update</code></h4>
<div class="paragraph">
<p>If you update these scripts, you should run</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cods update</pre>
</div>
</div>
<div class="paragraph">
<p>to ensure all of your individual server commands are using the most
recent version of the scripts. (This will make sure all of the symlinks
for each server command are pointing to the right place.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands">Commands</h3>
<div class="paragraph">
<p>The entrypoint for all commands is through the command that the <code>cods</code>
command creates. The created command contains various subcommands for
performing different activities on the server.</p>
</div>
<div class="paragraph">
<p>Broadly speaking, most of the subcommands will ssh into the server and
run a command or a series of commands to achieve the goal of the
command. This allows us to control the server from a local machine,
without much need to log in to the server itself.</p>
</div>
<div class="paragraph">
<p>For the rest of this guide, we’ll assume that the command we created is
named <code>myserver</code>. That is, assume we have already run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cods init myserver</pre>
</div>
</div>
<div class="paragraph">
<p>and successfully setup the server.</p>
</div>
<div class="paragraph">
<p>To see all the available subcommands, run the <code>myserver</code> command
without any arguments:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="api.md">API docs</a> for more details and examples for all of
the commands.</p>
</div>
</div>
<div class="sect2">
<h3 id="_site_creation">Site Creation</h3>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>One of</p>
<div class="ulist">
<ul>
<li>
<p>A java web application with an embedded webserver (e.g. embedded
tomcat) packaged as a jar</p>
</li>
<li>
<p>a node application</p>
</li>
<li>
<p>a python application</p>
</li>
<li>
<p>A static site (optionally with a build step)</p>
</li>
</ul>
</div>
</li>
<li>
<p>For any domain (or subdomain) you want to host on your server, you
will need to have the DNS records already configured to point to your
server’s IP.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This setup will allow you to host multiple different sites on your
server, possibly a mix of static and java or node-backed sites, and you
can even host different domains, or multiple different subdomains. For
example, you could setup a java api server at <code>api.example.com</code>, and a
static site that talks to the api at <code>example.com</code>.</p>
</div>
<div class="paragraph">
<p>When creating a new site, the <code>site create</code> subcommand will check to
see if the DNS records for the given domain point to your server. You
will be given a warning if they do not, but you can go ahead and create
the site anyway if you are still configuring DNS, or waiting for the
records to propogate.</p>
</div>
<div class="paragraph">
<p>If the DNS records are setup, you can pass <code>--enable-https</code> to the
<code>site create</code> command to also enable https for the site after the site
is created.</p>
</div>
<div class="sect3">
<h4 id="_reverse_proxy_sites">Reverse Proxy Sites</h4>
<div class="paragraph">
<p>Any site that is not a static site will be setup with nginx as a reverse
proxy to your application. This means that both your application and
nginx are running on the server, and when a request comes in, nginx will
forward it to your application.</p>
</div>
<div class="paragraph">
<p>This configuration allows for virtual hosting, i.e. multiple domains can
be hosted on the same server, and allows nginx to handle https.</p>
</div>
<div class="sect4">
<h5 id="_port_selection">Port Selection</h5>
<div class="paragraph">
<p>For Java, Node, and Python sites, you will need to choose a port for
your application to use on the server. Two applications <em>cannot</em> use the
same port, and this tool will prevent you from configuring two separate
sites to point to the same upstream proxy.</p>
</div>
<div class="paragraph">
<p>The port will need to be chosen when you create the site, and you can
view all the ports that are currently in use by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver ports</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_content">Static Content</h5>
<div class="paragraph">
<p>For any Java, Node, or Python site, nginx will be setup to serve static
content from a <code>public</code> directory within the site directory.</p>
</div>
<div class="paragraph">
<p>For example, if you created <code>example.com</code>, any files on the server in
<code>/srv/example.com/public</code> will be served as-is, that is, the requests
will not be passed to your application.</p>
</div>
<div class="paragraph">
<p>For Java sites, you will probably need to manually manage the contents
of this directory, or ignore it.</p>
</div>
<div class="paragraph">
<p>For Node or Python sites, if you have a <code>public</code> directory at the top
level of your project, any content in this directory will be served
directly.</p>
</div>
<div class="paragraph">
<p>Of course, you can simply choose to ignore this directory and have your
application handle static contents itself.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_site_creation">Java Site Creation</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver site create -d example.com --java -p 8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port specified will be passed as a command line argument to your
application (in this example, <code>--server.port=8080</code>)</p>
</div>
<div class="paragraph">
<p>When a site is setup, the server will be setup for automated builds and
deployments with git. This is accomplished through a <code>post-receive</code>
git hook. This functionality is two-fold: there is a simple setup, and
the ability to do somethings more advanced (see the customizing
deployment section below).</p>
</div>
<div class="paragraph">
<p>When the site is created, an empty git repository will be initialized
and named after the site, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/srv/example.com/repo.git</pre>
</div>
</div>
<div class="paragraph">
<p>You can find the exact git remote, as well as a copy-pastable command
for adding it by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info --domain example.com</pre>
</div>
</div>
<div class="paragraph">
<p>When the repo is pushed to, the post-receive git hook will be triggered,
which will run the build for your project, or run a custom script.</p>
</div>
<div class="sect4">
<h5 id="_cods"><code>.cods</code></h5>
<div class="paragraph">
<p>To tell the hook how to build your project, you will need to (at a bare
minimum), add a file to your project defining how to build your project,
and where the built <code>jar</code> file is output. To do this, create a file
named <code>.cods</code> in the root of your project with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">BUILD_COMMAND=command_to_execute_to_build_your_project.sh
JAR_FILE=relative/path/to/the_artifact.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a spring boot application, the file might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">BUILD_COMMAND='./mvnw package'
JAR_FILE=target/myblog-0.2.1-SNAPSHOT.jar</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_config_file"><code>config</code> file</h5>
<div class="paragraph">
<p>In addition to the build configuration, often times you will need to
include a file in the build that is not part of the git repository
(e.g. a file with database credentials). To do that, we can create that
file on the server, and tell the git hook how to find this file. To do
this, create the file you want to be included in the build inside of the
directory named after your site inside of <code>/srv</code>, and edit the
<code>config</code> file found in the same place.</p>
</div>
<div class="paragraph">
<p>For example, if you needed an <code>application.properties</code> file included
in the build for <code>example.com</code>, but this file is ignored by git, you
would do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ssh into the server and create the production
<code>application.properties</code> file inside the <code>/srv/example.com/</code>
directory.</p>
</li>
<li>
<p>edit the <code>/srv/example.com/config</code> file and define the name of the
file to be included, as well as where in the project it should be copied
to</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Take a look at the <code>config</code> file or template for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_deployment">Customizing Deployment</h5>
<div class="paragraph">
<p>If your deploment needs are more complex than what is described above,
you can create a file named <code>cods.sh</code> in the root of your project.
This file will be executed after pushing to the deployment remote if a
<code>.cods</code> file is not found. This script will be executed after freshly
cloning your project, from your project root, and several environment
variables are available to it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SITE_DIR</code>: the directory that has the repo for your site, along
with any config files you have setup there (example value:
<code>/srv/example.com</code>)</p>
</li>
<li>
<p><code>JAR_TARGET_LOCATION</code>: Where the built jar needs to end up (example
value: <code>/srv/example.com/app.jar</code>)</p>
</li>
<li>
<p><code>PUBLIC_DIR</code>: the directory for static files for your site (example:
<code>/srv/example.com/public</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cloned repo that is created will be deleted after the
<code>post-receive</code> hook finishes running.</p>
</div>
<div class="paragraph">
<p>Example <code>cods.sh</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># exit the script on any errors
set -e
# error on the use of any undefined variables
set -u

# 1. copy over any env specific files you setup on the server
cp $SITE_DIR/application.properties src/main/resources/application.properties
cp $SITE_DIR/secret.file src/main/resources/secret.file
cp $SITE_DIR/env.js src/main/javascript/env.js

# 2. Do any pre-build steps you need to (e.g. compiling css/js assets)
#    Any custom build/deployment logic should go here
echo '[cods.sh] Installing dependencies...'
echo '[cods.sh] &gt; npm install'
npm install
echo '[cods.sh] Building JS...'
echo '[cods.sh] &gt; npm run build'
npm run build

# 3. Build the jar file and put it in the right place
echo '[cods.sh] Building war file...'
echo '[cods.sh] &gt; ./mvnw package'
./mvnw package
mv target/my-awesome-project.jar $JAR_TARGET_LOCATION

# restart the service in order to run the new version of the application
sudo systemctl restart example.com</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_boot_shortcut">Spring Boot Shortcut</h5>
<div class="paragraph">
<p>You can add <code>--spring-boot</code> to the <code>site create</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site create --domain example.com --spring-boot</pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically setup the site’s <code>config</code> file to match the
default location for the <code>application.properties</code> file in a spring
boot application.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_node">Node</h4>
<div class="literalblock">
<div class="content">
<pre>myserver site create --node --port 3000 --domain my-node-site.com</pre>
</div>
</div>
<div class="paragraph">
<p>This tool relies on a <code>npm start</code> command being defined on your
project that starts the web server.</p>
</div>
<div class="paragraph">
<p>It is up to you to ensure that the port that your application runs on is
the same as the port that you pass when you run the above command to
create the node site.</p>
</div>
<div class="paragraph">
<p>A git remote will be created for you, and a <code>post-receive</code> hook will
be setup so that when you push the <code>master</code> branch to the remote on
the server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The new version of the code is checked out, replacing the old version</p>
</li>
<li>
<p>If a file named <code>cods.sh</code> exists at the root of the project, it will
be run, and a variable named <code>SITE_DIR</code> will be available to it that
contains the location of the directory for your site (and the source
code).</p>
</li>
<li>
<p>If no <code>cods.sh</code> is found, <code>npm install</code> will be run</p>
</li>
<li>
<p>The site service will be restarted, i.e. the old <code>npm run start</code>
process will be killed, and it will be started again</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See
<a href="https://github.com/zgulde/cods/tree/master/tests/sample-sites/node">the
example node site for a simplified example</a>.</p>
</div>
<div class="paragraph">
<p>You can find the git remote and a copy-pastable command to add it to
your project by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info --domain my-node-site.com</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_python">Python</h4>
<div class="literalblock">
<div class="content">
<pre>myserver site create --python --port 5000 --domain example-python-site.com</pre>
</div>
</div>
<div class="paragraph">
<p>In order to host a python site, you’ll need to have an executable script
named <code>start_server.sh</code> as part of your project. When run, this script
should start your webserver on the port you specified in the above
command.</p>
</div>
<div class="paragraph">
<p>Assuming <code>server.py</code> starts the web server, your script might look
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash

# ensure the virtualenv directory is present
if [[ ! -d env ]] ; then
    echo 'env directory not found!'
    exit 1
fi

# activate the venv and start the server
source env/bin/activate
python server.py</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script should start the application in production mode, for
example, you may use this script to start your application with one of
python’s wsgi web servers, e.g. <code>gunicorn</code> or <code>waitress</code> (I.e. don’t
start your app in development/debugging mode!).</p>
</div>
<div class="paragraph">
<p>You can add a file named <code>cods.sh</code> to the root of your project to run
custom code whenever the site is deployed as well. This script will have
an environment variable, <code>SITE_DIR</code> available to it, that specifies
the location of your source code on the server.</p>
</div>
<div class="paragraph">
<p>For example, if your wanted to re-create the virtual environment
everytime the site is deployed, your <code>cods.sh</code> script might look like
this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#!/usr/bin/env bash

cd $SITE_DIR

echo "[cods.sh] (re-)creating the venv"
echo '[cods.sh] - rm -rf env'
rm -rf env
echo '[cods.sh] python3 -m venv env'
python3 -m venv env
echo '[cods.sh] source env/bin/activate'
source env/bin/activate
echo '[cods.sh] python3 -m pip install -r requirements.txt'
python3 -m pip install -r requirements.txt</pre>
</div>
</div>
<div class="paragraph">
<p>When you push to the git remote on the server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The new source code will be checked out, replacing the old version</p>
</li>
<li>
<p>If a <code>cods.sh</code> file is found, it will be run</p>
</li>
<li>
<p>The currently running server process will be killed, and the server
will be started again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find the git remote and a copy-pastable command to add it to
your project by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info --domain example-python-site.com</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_php">PHP</h4>
<div class="literalblock">
<div class="content">
<pre>myserver site create --php --domain my-php-site.com</pre>
</div>
</div>
<div class="paragraph">
<p>A git remote will be created for you, and a <code>post-receive</code> hook will
be setup so that when you push the <code>master</code> branch to the remote on
the server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The new version of the code is checked out, replacing the old version.</p>
</li>
<li>
<p>If a file named <code>cods.sh</code> exists at the root of the project, it will
be run, and a variable named <code>SITE_DIR</code> will be available to it that
contains the location of the directory for your site (and the source
code).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See
<a href="https://github.com/zgulde/cods/tree/master/tests/sample-sites/php">the
example php site for a simplified example</a> or the
<a href="https://github.com/zgulde/cods/tree/master/tests/sample-sites/php">example
laravel site</a>.</p>
</div>
<div class="paragraph">
<p>You can find the git remote and a copy-pastable command to add it to
your project by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info --domain my-node-site.com</pre>
</div>
</div>
<div class="paragraph">
<p>Note that for a php site, by default, nginx will not handle 404s,
i.e. missing paths will be sent to your <code>index.php</code> file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_static_site_creation">Static Site Creation</h4>
<div class="literalblock">
<div class="content">
<pre>myserver site create --static --domain example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Like creating a java site, you can also pass <code>--enable-https</code> to
activate https for the site after creating it.</p>
</div>
<div class="paragraph">
<p>Like a java site, git deployment is setup when you create the site. You
can run</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info --domain example.com</pre>
</div>
</div>
<div class="paragraph">
<p>To find the deployment remote.</p>
</div>
<div class="paragraph">
<p>Deploying a static site is as simple as pushing, when you push, the
contents of your site will be replaced with the most recent contents of
your git repository.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/zgulde/cods/tree/master/tests/sample-sites/static">Here
is a very minimal example of a static site</a>.</p>
</div>
<div class="sect4">
<h5 id="_404_page_and_rewrites">404 Page and Rewrites</h5>
<div class="paragraph">
<p>If a page is not found, nginx will serve the file named <code>404.html</code>
from the root of your project (you should create this file yourself).</p>
</div>
<div class="paragraph">
<p>If you want to deploy a site that does the routing on the frontend (for
example react + react router), you will probably want your nginx
configuration to rewrite missing files to the index.html page. The nginx
config that is setup for a static site contains comments and commented
out configuration that explain how to do this.</p>
</div>
<div class="paragraph">
<p>Run the <code>site info</code> command to find the path to your site’s nginx
config file, then edit the nginx config file (read the comments in the
<code>location /</code>), and finally, restart nginx and you should be good to
go.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site info -d example.com
myserver run sudo nano /etc/nginx/sites-available/example.com
myserver restart --service=nginx</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_sites_with_a_build_process">Static Sites with a Build Process</h5>
<div class="paragraph">
<p>Of course some static sites have a build process (e.g. webpack or sass).
This tool is setup to accomodate these as well.</p>
</div>
<div class="sect5">
<h6 id="_cods_file"><code>.cods</code> file</h6>
<div class="paragraph">
<p>If your site can be built with a single command and outputs a single
directory, it is easy to setup automated builds when you deploy.</p>
</div>
<div class="paragraph">
<p>Create a file named <code>.cods</code> at the root of your project. It should
have the following contents:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BUILD_COMMAND='npm run build'
OUTPUT_DIR='build'</pre>
</div>
</div>
<div class="paragraph">
<p>Replacing <code>npm run build</code> with the command used to build your project,
and <code>build</code> with the name of the directory that contains your site’s
contents. If this file is setup, everytime you push to the git remote on
the server, the build command will be run, and the contents of the
output directory will be deployed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_custom_deployment">Custom Deployment</h6>
<div class="paragraph">
<p>If there is a file named <code>cods.sh</code> in the root of the project, instead
of copying the contents of the repository, the <code>cods.sh</code> script will
be run after pushing to the deployment remote.</p>
</div>
<div class="paragraph">
<p>The script will be run with the current working directory as a fresh
clone of your project. The clone will be removed when the <code>cods.sh</code>
script finishes running, so after you preform any build steps, you
should move the built files to the public directory for your project
(see example below).</p>
</div>
<div class="paragraph">
<p>When the script is run, several variables will be available to it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SITE_DIR</code>: the location on the server that holds the site’s
configuration</p>
</li>
<li>
<p><code>PUBLIC_DIR</code>: the location of files for your site</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example <code>cods.sh</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># exit script on any error
set -e

echo '[cods.sh] Building...'
npm install
npm run build

echo '[cods.sh] Build Success, deploying...'
mv build/* $PUBLIC_DIR

echo '[cods.sh] All Done!'</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manually_triggering_a_build_for_a_site">Manually Triggering A Build for a Site</h4>
<div class="paragraph">
<p>You can also manually trigger a build and deploy for a site without
needing to push to the git remote on your server.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site build -d example.com</pre>
</div>
</div>
<div class="paragraph">
<p>This will run the same commands that run when you push to the remote.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_database_management">Database Management</h3>
<div class="paragraph">
<p>While theoretically you might not need to do this, most applications
will need to talk to a database in some form or fashion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver db create -n some_db -u some_user</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will create a database and a user that has all permissions
on that database (but not any others). The new user’s password will be
automatically generated and put into the <code>credentials.txt</code> file, which
can be viewed by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver credentials</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_https">HTTPS</h3>
<div class="paragraph">
<p>The site management command has a sub command that will obtain a
certificate from <a href="https://letsencrypt.org/">letsencrypt</a> and enable https
on a per-site basis.</p>
</div>
<div class="paragraph">
<p>To obtain a certificate from letsencrypt, you will need to have the DNS
records for your domain properly configured to point to your server, so
that you can prove ownership of that domain.</p>
</div>
<div class="paragraph">
<p><strong>Before using this command make sure you agree to the
<a href="https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf">Lets
Encrypt Subscriber Agreement</a>.</strong></p>
</div>
<div class="paragraph">
<p>Simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver site enablehttps -d myawesomesite.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>After enabling https for a site, you can enable the automatic renewal of
certificates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver autorenew</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that while you do need to enable https for each site individually,
you only need to set up automatic certificate renewal once.</p>
</div>
<div class="paragraph">
<p>You can also enable https when the site is being created:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver site create --domain example.com --enable-https</pre>
</div>
</div>
<div class="paragraph">
<p>This is functionally the same thing as running the <code>site create</code> and
<code>site enablehttps</code> commands back to back.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sharing_your_server">Sharing your server</h3>
<div class="paragraph">
<p><strong>For person who setup the server</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you want to give admin access to your teammate.</p>
<div class="paragraph">
<p>The <code>myserver user add</code> command will create another user account on
the server <strong>with admin privileges</strong>.</p>
</div>
</li>
<li>
<p>Get your teamate’s public ssh key and save it locally</p>
</li>
<li>
<p>Run the appropriate <code>myserver</code> command</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">myserver user add -u sally -f ~/sallys_ssh_key.pub</code></pre>
</div>
</div>
</li>
<li>
<p>Take note of the randomly generated password</p>
</li>
<li>
<p>(Optionally) log into your mysql server and create a database
administrator account for the new user.</p>
<div class="literalblock">
<div class="content">
<pre>myserver db login
# from mysql
CREATE USER sally@localhost IDENTIFIED BY 'astrongpassword';
GRANT ALL ON *.* TO sally@localhost WITH GRANT OPTION;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>For the teamate being added</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup the command</p>
<div class="literalblock">
<div class="content">
<pre>cods add shared-server</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_adding_a_user_from_github">Adding a User From Github</h4>
<div class="paragraph">
<p>You can also add a user to the server based on their github username.
For example, to add <code>zgulde</code> to your server, you would run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>myserver user add --github-username zgulde</pre>
</div>
</div>
<div class="paragraph">
<p>This command will create a user with the same login as the github
username, a randomly chosen password, and will use whatever public keys
are associated with the user’s github account (you can find these by
going to, e.g., <a href="https://github.com/zgulde.keys" class="bare">https://github.com/zgulde.keys</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bash_completion">Bash Completion</h3>
<div class="paragraph">
<p>There is a subcommand to generate bash tab completion for the command
that is setup: <code>bash-completion</code>. You can add a line like the
following to the end of your <code>.bashrc</code> (<code>.bash_profile</code> if you’re on
Mac) like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>eval "$(myserver bash-completion)"</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-15 20:08:56 -0500
</div>
</div>
</body>
</html>